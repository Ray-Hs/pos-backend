enum PaymentMethod {
    CASH
    CARD
    DEBT
}

model InvoiceRef {
    id        Int      @id @default(autoincrement()) // Stable identifier
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    orderId Int?

    invoices Invoice[] // All versions
    Order    Order?    @relation(fields: [orderId], references: [id])
}

model Invoice {
    id              Int     @id @default(autoincrement())
    invoiceRefId    Int
    version         Int
    isLatestVersion Boolean @default(true)

    subtotal      Float
    total         Float
    paymentMethod PaymentMethod?
    paid          Boolean        @default(false)

    taxId              Int?
    serviceId          Int?
    userId             Int
    tableId            Int?
    customerDiscountId Int?

    discount   CustomerDiscount? @relation(fields: [customerDiscountId], references: [id])
    tax        Tax?              @relation(fields: [taxId], references: [id])
    service    Service?          @relation(fields: [serviceId], references: [id])
    user       User              @relation(fields: [userId], references: [id])
    table      Table?            @relation(fields: [tableId], references: [id])
    invoiceRef InvoiceRef        @relation(fields: [invoiceRefId], references: [id])

    createdAt        DateTime           @default(now())
    DeletedOrderItem DeletedOrderItem[]

    @@index([invoiceRefId, isLatestVersion])
}
